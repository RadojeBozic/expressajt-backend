<template>
  <section>
    <!-- ‚ú® Pozadinska animacija -->
    <div class="absolute inset-0 -z-10">
      <Particles class="absolute inset-0" />
      <div class="absolute left-1/2 -translate-x-1/2 bottom-0">
        <img src="../../../images/glow-top.svg" class="max-w-none" width="2146" height="774" alt="Pozadinska animacija" />
      </div>
    </div>

    <div class="relative max-w-6xl mx-auto">
      <Header />

      <div class="pt-32 pb-16 md:pt-52 md:pb-32">
        <div class="max-w-4xl mx-auto">
          <h1 class="text-3xl font-bold mb-6 text-center">üîê {{ $t('vuln.title') }}</h1>
          <p class="text-slate-400 text-center mb-12">
            {{ $t('vuln.intro') }}
          </p>

          <form @submit.prevent="submitReport" class="space-y-6 bg-slate-800 p-6 rounded-lg shadow">
            <div>
              <label class="block text-sm mb-1" for="name">{{ $t('vuln.name') }}</label>
              <input v-model="form.name" id="name" required type="text" class="w-full p-2 rounded bg-slate-700 border border-slate-600" />
            </div>

            <div>
              <label class="block text-sm mb-1" for="email">Email</label>
              <input v-model="form.email" id="email" required type="email" class="w-full p-2 rounded bg-slate-700 border border-slate-600" />
            </div>

            <div>
              <label class="block text-sm mb-1" for="summary">{{ $t('vuln.summary') }}</label>
              <input v-model="form.summary" id="summary" required type="text" class="w-full p-2 rounded bg-slate-700 border border-slate-600" />
            </div>

            <div>
              <label class="block text-sm mb-1" for="details">{{ $t('vuln.details') }}</label>
              <textarea v-model="form.details" id="details" rows="5" required class="w-full p-2 rounded bg-slate-700 border border-slate-600"></textarea>
            </div>

            <div class="text-center">
              <button type="submit" :disabled="loading" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded text-white font-semibold">
                {{ loading ? $t('vuln.sending') : $t('vuln.submit') }}
              </button>
            </div>

            <p v-if="successMessage" class="text-green-400 text-sm text-center mt-4">{{ successMessage }}</p>
            <p v-if="errorMessage" class="text-red-400 text-sm text-center mt-4">{{ errorMessage }}</p>
          </form>
        </div>

        <!-- ‚ú® Donja pozadina -->
        <div class="absolute inset-0 -z-10">
          <Particles class="absolute inset-0" />
          <div class="absolute left-1/2 -translate-x-1/2 bottom-0">
<!--             <img src="../../../images/glow-bottom.svg" class="max-w-none" width="546" height="274" alt="Pozadina" />
 -->          </div>
        </div>
      </div>

      <Footer />
    </div>
  </section>
</template>

<script>
import Header from '../../../partials/Header.vue'
import Footer from '../../../partials/Footer.vue'
import Particles from '../../../partials/Particles.vue'
import axios from 'axios'

export default {
  name: 'VulnerabilityPage',
  components: {
    Header,
    Footer,
    Particles
  },
  data() {
    return {
      form: {
        name: '',
        email: '',
        summary: '',
        details: ''
      },
      loading: false,
      successMessage: '',
      errorMessage: ''
    }
  },
  methods: {
    async submitReport() {
      this.loading = true
      this.successMessage = ''
      this.errorMessage = ''

      try {
        const payload = {
          name: this.form.name,
          email: this.form.email,
          url: '',
          description: `${this.form.summary}\n\n${this.form.details}`
        }

        await axios.post('http://localhost:8080/api/report-vulnerability', payload)

        this.successMessage = this.$t('vuln.success')
        this.form = { name: '', email: '', summary: '', details: '' }
      } catch (error) {
        console.error(error)
        if (error.response?.data?.errors) {
          const errors = Object.values(error.response.data.errors).flat()
          this.errorMessage = errors[0]
        } else {
          this.errorMessage = this.$t('vuln.error')
        }
      } finally {
        this.loading = false
      }
    }
  }
}
</script>
